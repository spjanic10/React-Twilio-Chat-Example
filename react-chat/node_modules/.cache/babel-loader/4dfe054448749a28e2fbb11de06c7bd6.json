{"ast":null,"code":"import _regeneratorRuntime from\"/Users/stefanpjanic/Desktop/mango_dev/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/stefanpjanic/Desktop/mango_dev/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Users/stefanpjanic/Desktop/mango_dev/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/stefanpjanic/Desktop/mango_dev/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/stefanpjanic/Desktop/mango_dev/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/stefanpjanic/Desktop/mango_dev/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/stefanpjanic/Desktop/mango_dev/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component,PureComponent}from\"react\";import styles from\"./assets/MessageBubble.module.css\";import{Spin,Modal,Icon}from\"antd\";import ChatIcon from\"./ChatIcon\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var MessageBubble=/*#__PURE__*/function(_Component){_inherits(MessageBubble,_Component);var _super=_createSuper(MessageBubble);function MessageBubble(props){var _this;_classCallCheck(this,MessageBubble);_this=_super.call(this,props);_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.t0=_this;_context.t1=_objectSpread;_context.t2=_objectSpread({},_this.state);_context.t3={};_context.next=6;return _this.props.message.getParticipant();case 6:_context.t4=_context.sent.type;_context.t5={type:_context.t4};_context.t6=(0,_context.t1)(_context.t2,_context.t3,_context.t5);_context.t0.setState.call(_context.t0,_context.t6);if(_this.state.hasMedia){_this.props.message.media.getContentTemporaryUrl().then(function(url){_this.setState({mediaUrl:url});}).catch(function(e){return _this.setState({mediaDownloadFailed:true});});}document.getElementById(_this.props.message.sid).scrollIntoView({behavior:\"smooth\"});case 12:case\"end\":return _context.stop();}}},_callee);}));_this.render=function(){var _ref2=_this.props.direction===\"incoming\"?{itemStyle:styles.received_msg,divStyle:styles.received_withd_msg}:{itemStyle:styles.outgoing_msg,divStyle:styles.sent_msg},itemStyle=_ref2.itemStyle,divStyle=_ref2.divStyle;var m=_this.props.message;var type=_this.state.type;if(_this.state.hasMedia){console.log(\"Message is media message\");// log media properties\nconsole.log(\"Media properties\",m.media);}console.log(m);return/*#__PURE__*/_jsx(\"li\",{id:m.sid,className:itemStyle,children:/*#__PURE__*/_jsxs(\"div\",{className:divStyle,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"strong\",{children:[type===\"chat\"&&/*#__PURE__*/_jsx(Icon,{style:{fontSize:\"16px\"},component:ChatIcon}),type===\"sms\"&&/*#__PURE__*/_jsx(Icon,{type:\"mobile\"}),\" \".concat(m.author)]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"div\",{className:styles.medias,children:_this.state.hasMedia&&/*#__PURE__*/_jsx(Media,{hasFailed:_this.state.mediaDownloadFailed,url:_this.state.mediaUrl})}),m.body]}),/*#__PURE__*/_jsx(\"span\",{className:styles.time_date,children:m.state.timestamp.toLocaleString()})]})});};_this.state={hasMedia:_this.props.message.type===\"media\",mediaDownloadFailed:false,mediaUrl:null};return _this;}_createClass(MessageBubble,[{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState,snapshot){document.getElementById(this.props.message.sid).scrollIntoView({behavior:\"smooth\"});}}]);return MessageBubble;}(Component);var Media=/*#__PURE__*/function(_PureComponent){_inherits(Media,_PureComponent);var _super2=_createSuper(Media);function Media(){var _this2;_classCallCheck(this,Media);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this2=_super2.call.apply(_super2,[this].concat(args));_this2.render=function(){var _this2$props=_this2.props,hasFailed=_this2$props.hasFailed,url=_this2$props.url;return/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(styles.media).concat(!url?\" \"+styles.placeholder:\"\"),onClick:function onClick(){Modal.info({centered:true,icon:null,okText:\"Close\",width:\"60%\",content:/*#__PURE__*/_jsx(\"div\",{className:styles.picture_container,children:/*#__PURE__*/_jsx(\"img\",{style:{width:\"100%\",height:\"100%\"},alt:\"description\",src:url})})});},children:[!url&&!hasFailed&&/*#__PURE__*/_jsx(Spin,{}),hasFailed&&/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",flexDirection:\"column\"},children:[/*#__PURE__*/_jsx(Icon,{type:\"warning\",style:{fontSize:\"5em\"}}),/*#__PURE__*/_jsx(\"p\",{children:\"Failed to load media\"})]}),!hasFailed&&url&&/*#__PURE__*/_jsxs(\"div\",{className:styles.media_icon,children:[/*#__PURE__*/_jsx(\"div\",{style:{zIndex:123,position:\"absolute\"},children:/*#__PURE__*/_jsx(Icon,{type:\"eye\",style:{fontSize:\"5em\",opacity:0.3}})}),/*#__PURE__*/_jsx(\"div\",{className:styles.picture_preview,style:{backgroundImage:\"url(\".concat(url,\")\"),zIndex:122}})]})]});};return _this2;}return Media;}(PureComponent);export default MessageBubble;","map":{"version":3,"sources":["/Users/stefanpjanic/Desktop/mango_dev/react-chat/src/MessageBubble.js"],"names":["React","Component","PureComponent","styles","Spin","Modal","Icon","ChatIcon","MessageBubble","props","componentDidMount","state","message","getParticipant","type","setState","hasMedia","media","getContentTemporaryUrl","then","url","mediaUrl","catch","e","mediaDownloadFailed","document","getElementById","sid","scrollIntoView","behavior","render","direction","itemStyle","received_msg","divStyle","received_withd_msg","outgoing_msg","sent_msg","m","console","log","fontSize","author","medias","body","time_date","timestamp","toLocaleString","prevProps","prevState","snapshot","Media","hasFailed","placeholder","info","centered","icon","okText","width","content","picture_container","height","display","flexDirection","media_icon","zIndex","position","opacity","picture_preview","backgroundImage"],"mappings":"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","sourcesContent":["import React, { Component, PureComponent } from \"react\";\nimport styles from \"./assets/MessageBubble.module.css\";\nimport PropTypes from \"prop-types\";\nimport { Spin, Modal, Icon } from \"antd\";\n\nimport ChatIcon from \"./ChatIcon\";\n\nclass MessageBubble extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      hasMedia: this.props.message.type === \"media\",\n      mediaDownloadFailed: false,\n      mediaUrl: null\n    };\n  }\n\n  componentDidMount = async () => {\n    this.setState({\n      ...this.state,\n      type: (await this.props.message.getParticipant()).type\n    });\n    if (this.state.hasMedia) {\n      this.props.message.media\n        .getContentTemporaryUrl()\n        .then((url) => {\n          this.setState({ mediaUrl: url });\n        })\n        .catch((e) => this.setState({ mediaDownloadFailed: true }));\n    }\n    document\n      .getElementById(this.props.message.sid)\n      .scrollIntoView({ behavior: \"smooth\" });\n  };\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    document\n      .getElementById(this.props.message.sid)\n      .scrollIntoView({ behavior: \"smooth\" });\n  }\n\n  render = () => {\n    const { itemStyle, divStyle } =\n      this.props.direction === \"incoming\"\n        ? {\n            itemStyle: styles.received_msg,\n            divStyle: styles.received_withd_msg\n          }\n        : { itemStyle: styles.outgoing_msg, divStyle: styles.sent_msg };\n\n    const m = this.props.message;\n    const type = this.state.type;\n\n    if (this.state.hasMedia) {\n      console.log(\"Message is media message\");\n      // log media properties\n      console.log(\"Media properties\", m.media);\n    }\n    console.log(m);\n    return (\n      <li id={m.sid} className={itemStyle}>\n        <div className={divStyle}>\n          <div>\n            <strong>\n              \n              {type === \"chat\" && (\n                <Icon style={{ fontSize: \"16px\" }} component={ChatIcon} />\n              )}\n              {type === \"sms\" && <Icon type={\"mobile\"} />}\n              {` ${m.author}`}\n            </strong>\n\n            <br />\n            <div className={styles.medias}>\n              {this.state.hasMedia && (\n                <Media\n                  hasFailed={this.state.mediaDownloadFailed}\n                  url={this.state.mediaUrl}\n                />\n              )}\n            </div>\n            {m.body}\n          </div>\n          <span className={styles.time_date}>\n            {m.state.timestamp.toLocaleString()}\n          </span>\n        </div>\n      </li>\n    );\n  };\n}\n\nclass Media extends PureComponent {\n  render = () => {\n    const { hasFailed, url } = this.props;\n    return (\n      <div\n        className={`${styles.media}${!url ? \" \" + styles.placeholder : \"\"}`}\n        onClick={() => {\n          Modal.info({\n            centered: true,\n            icon: null,\n            okText: \"Close\",\n            width: \"60%\",\n            content: (\n              <div className={styles.picture_container}>\n                <img style={{ width: \"100%\", height: \"100%\" }} alt=\"description\" src={url} />\n              </div>\n            )\n          });\n        }}\n      >\n        {!url && !hasFailed && <Spin />}\n\n        {hasFailed && (\n          <div style={{ display: \"flex\", flexDirection: \"column\" }}>\n            <Icon type={\"warning\"} style={{ fontSize: \"5em\" }} />\n            <p>Failed to load media</p>\n          </div>\n        )}\n\n        {!hasFailed && url && (\n          <div className={styles.media_icon}>\n            <div style={{ zIndex: 123, position: \"absolute\" }}>\n              <Icon type={\"eye\"} style={{ fontSize: \"5em\", opacity: 0.3 }} />\n            </div>\n            <div\n              className={styles.picture_preview}\n              style={{ backgroundImage: `url(${url})`, zIndex: 122 }}\n            ></div>\n          </div>\n        )}\n      </div>\n    );\n  };\n}\n\nMedia.propTypes = {\n  hasFailed: PropTypes.bool.isRequired,\n  url: PropTypes.string\n};\n\nexport default MessageBubble;\n"]},"metadata":{},"sourceType":"module"}